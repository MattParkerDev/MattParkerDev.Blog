@using MattParkerDev.WebUI.Services
@using System.Net

@inject HttpClient Http

<MudText Typo="Typo.h3" GutterBottom="true">@BlogTitle</MudText>
<style>
    /* Until MudMarkdown Update their styles */
    .mud-markdown-body blockquote {
        margin-bottom: 1.25em !important;
    }
    .mud-markdown-body blockquote p {
        margin-bottom: 0 !important;
    }
</style>
<MudMarkdown CodeBlockTheme="CodeBlockTheme.Obsidian" Value="@MarkdownContent" />

@code {

    [Parameter]
    public string BlogSlug { get; set; } = default!;
    
    private string BlogTitle { get; set; } = string.Empty;
    private string MarkdownContent { get; set; } = string.Empty;
    
    protected override async Task OnParametersSetAsync()
    {
        var blog = BlogService.GetBlogBySlug(BlogSlug);
        if (blog is null)
        {
            BlogTitle = "404 Not Found 😢";
            MarkdownContent = "Head back to [blogs!](/blog)";
            return;
        }
        try
        {
            var blogContent = await Http.GetStringAsync($"_blogs/{blog.Slug}/{blog.Slug}.md");
            BlogTitle = blog.Title;
            MarkdownContent = blogContent;
        }
        catch (HttpRequestException e) when (e.StatusCode == HttpStatusCode.NotFound)
        {
            BlogTitle = "404 Not Found 😢";
            MarkdownContent = "Head back to [blogs!](/blog)";
        }
    }
}